use my_database


db.users.find()


use tutorial2

db.dropDatabase()

db.users.insertOne({username: "smith"})

db.users.insertMany([{username: "tom"}, {username: "jones"}])

// í™•ì¸(ì¡°íšŒ)
db.users.find()

db.users.countDocuments()   // ë„íë¨¼íŠ¸(í–‰) ê°œìˆ˜ í™•ì¸
db.users.estimatedDocumentCount()   // ì¶”ì •ì¹˜ ê³„ì‚°


// ì¡°ê±´ë¶€ ê²€ìƒ‰
db.users.find({username: "jones"})

// ë¹ˆ ì¡°ê±´
db.users.find()     // db.users.find({})ì™€ ë™ì¼



// ë…¼ë¦¬ ì—°ì‚°ì í™œìš©
// AND
// ê¸°ë³¸ AND (ì•”ì‹œì )
db.users.find({_id : ObjectId("6833ee54c65900417966a601"), username : "smith"})

// ëª…ì‹œì  AND
db.users.find({$and: [
        {_id : ObjectId("6833ee54c65900417966a601")},
        {username : "smith"}
    ]})



// OR ì—°ì‚°ì ì‚¬ìš©
db.users.find({
    $or: [
        {username: "smith"},
        {username: "jones"}
    ]
})



// update ê´€ë ¨

// ì‹  ë²„ì „
db.users.updateOne({username: "smith"}, {$set: {country2: "Canada2"}})

db.users.find()


// unset: í•„ë“œ ì‚­ì œ
db.users.updateOne({username: "smith"}, {$unset: {country2: 1}})

db.users.find()


// ë„íë¨¼íŠ¸ ëŒ€ì²´
db.users.replaceOne({username: "smith"}, {country2: "Canada"})

db.users.find()

db.users.updateOne({country2: "Canada"}, {$set: {username: "smith", country2: "Canada"}})

db.users.find()



// ë³µì¡í•œ ë°ì´í„° ì—…ë°ì´íŠ¸
db.users.updateOne({username: "smith"}, {
    $set: {
        favorites: {
            cities: ["Chicago", "Cheyenne"],
            movies: ["Casablanca", "For a Fow Dollars More", "The Sting"]
        }
    }
})


db.users.updateOne({username: "jones"},
    {
        $set: {
            favorites: {
                movies: ["Casablanca", "Rocky"]
            }
        }
    })

db.users.find();
db.users.find({"favorites.movies": "Casablanca"}).pretty()  // favorites.moveì— Casablancaê°€ ìˆëŠ” ì»¬ë ‰ì…˜ë§Œ ì¶œë ¥


// ë°°ì—´ ì¡°ì‘ ì—°ì‚°ì
// $push: ë°°ì—´ì— ë¬´ì¡°ê±´ ì¶”ê°€(ì¤‘ë³µ ê°€ëŠ¥)
// $addToSet: ë°°ì—´ì— ì¤‘ë³µë˜ì§€ ì•Šì€ ìš”ì†Œë§Œ ì¶”ê°€(ì¤‘ë³µ ë¶ˆê°€)

// ì‹  ë²„ì „ (MongoDB 3.2+) - ê¶Œì¥
db.users.updateMany(
    {"favorites.movies": "Casablanca"},
    {$addToSet: {"favorites.movies": "The Maltese Falcon"}},
    {upsert: false} // multi ì˜µì…˜ ë¶ˆí•„ìš”
)

db.users.find()
// 1. favorites ê°ì²´ ì•ˆì˜ movies ë°°ì—´ì— "Casablanca"ê°€ í¬í•¨ëœ ë„íë¨¼íŠ¸ ì°¾ê¸°
// 2. favorites.movies ë°°ì—´ì— "The Maltese Falcon" ì¶”ê°€ (ì´ë¯¸ ìˆìœ¼ë©´ ì¶”ê°€ ì•ˆí•¨)
// 3. upsert: false: ì¡°ê±´ì— ë§ëŠ” ë„íë¨¼íŠ¸ê°€ ì—†ì–´ë„ ìƒˆë¡œ ìƒì„±í•˜ì§€ ì•ŠìŒ
// 4. multi: true: ì¡°ê±´ì— ë§ëŠ” ëª¨ë“  ë„íë¨¼íŠ¸ë¥¼ ìˆ˜ì •


// === ë‹¨ì¼ ì—…ë°ì´íŠ¸ (ì‹ ë²„ì „) ===
db.users.updateOne(
    {"favorites.movies": "Casablanca"},
    {$push: {"favorites.movies": "Citizen Kane"}}
)

db.users.find()
// 1. favorites ê°ì²´ ì•ˆì˜ movies ë°°ì—´ì— "Casablanca"ê°€ í¬í•¨ëœ ë„íë¨¼íŠ¸ ì°¾ê¸°
// -updateOne() ë©”ì„œë“œì´ê¸° ë•Œë¬¸ì— ì¡°ê±´ì— ë§ëŠ” ì²« ë²ˆì§¸ ë„íë¨¼íŠ¸ë§Œ ìˆ˜ì •
// 2. favorites.movies ë°°ì—´ì— "Citizen Kane" ì¶”ê°€ (ì¤‘ë³µ í—ˆìš©)



// ë°ì´í„° ì‚­ì œ
db.users.deleteOne({"favorites.cities": "Cheyenne"})    // ì²« ë²ˆì§¸ ë¬¸ì„œë§Œ ì‚­ì œ
db.users.deleteMany({"favorites.cities": "Cheyenne"})   // ì¡°ê±´ì— ë§ëŠ” ëª¨ë“  ë¬¸ì„œ ì‚­ì œ
db.users.find()

db.users.deleteMany({})   // ëª¨ë“  ë¬¸ì„œ ì‚­ì œ (ì»¬ë ‰ì…˜ ìœ ì§€)
db.users.find()

db.users.drop() // ë²„ì „ ë¬´ê´€ - ì»¬ë ‰ì…˜ ìì²´ ì‚­ì œ
db.users.find()


// ---------------------------------------------------

// ì¸ë±ìŠ¤
// ë°©ë²• 2: ê°œë³„ ì‚½ì… (í˜¸í™˜ì„± ìš°ì„ ì‹œ)
for(let i = 0; i < 20000; i++) {
    db.numbers.insertOne({num: i});
}

// ë„íë¨¼íŠ¸ ê°œìˆ˜ í™•ì¸
db.numbers.countDocuments()

// í° ê°’ ê²€ìƒ‰ ($gt: greater than)
db.numbers.find({num: {"$gt": 199995}})

// ë²”ìœ„ ê²€ìƒ‰ ($gt, $lt)
db.numbers.find({num: {"$gt": 20, "$lt": 25}})

// ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš í™•ì¸
db.numbers.find({num: {"$gt": 199995}}).explain("executionStats")



// === ì¸ë±ìŠ¤ ìƒì„± ===
// ì‹  ë²„ì „ (MongoDB 3.0+) - ê¶Œì¥
db.numbers.createIndex({num: 1})

// === ì¸ë±ìŠ¤ í™•ì¸ ===
db.numbers.getIndexes()  // ë²„ì „ ë¬´ê´€

// === ë³µí•© ì¸ë±ìŠ¤ ìƒì„± (ì‹ ë²„ì „ ì˜ˆì‹œ) ===
db.users.createIndex({username: 1, age: -1})  // username ì˜¤ë¦„ì°¨ìˆœ, age ë‚´ë¦¼ì°¨ìˆœ

// === ì¸ë±ìŠ¤ ì˜µì…˜ í™œìš© ===
db.users.createIndex(
    {email: 1},
    {unique: true, sparse: true}  // ìœ ë‹ˆí¬ ì¸ë±ìŠ¤, null ê°’ ì œì™¸
)

// ì¸ë±ìŠ¤ ì ìš© í›„ explain() ê²°ê³¼
db.numbers.find({num: {"$gt": 199995}}).explain("executionStats")





// ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ ë³´ê¸°
show dbs

// í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì»¬ë ‰ì…˜ ëª©ë¡ ë³´ê¸°
show collections

// ì‹  ë²„ì „ (MongoDB 4.4+) - ë” ìì„¸í•œ ì •ë³´
db.runCommand({dbStats: 1})
db.runCommand({collStats: "numbers"})

db.stats()

// === ì—°ê²° ìƒíƒœ í™•ì¸ ===
db.hello()  // MongoDB 5.0+



// ---------------------------------------
// ================================
// MongoDB ì¿¼ë¦¬ ì‹¤ìŠµìš© ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ì¹´í…Œê³ ë¦¬ë³„ 10ê°œ ìƒí’ˆ)
// ================================

use tutorial2
db.dropDatabase()


// === 1. ê¸°ì¡´ ë°ì´í„° ì •ë¦¬ ===
db.categories.deleteMany({})
db.products.deleteMany({})
db.users.deleteMany({})
db.reviews.deleteMany({})

console.log("=== ê¸°ì¡´ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ ===")

// === 2. ì¹´í…Œê³ ë¦¬ ë°ì´í„° (5ê°œ, í‰ë©´ êµ¬ì¡°) ===
const categories = [
    {
        _id: ObjectId("6a5b1476238d3b4dd5000001"),
        name: "Electronics",
        slug: "electronics",
        description: "Electronic devices and accessories"
    },
    {
        _id: ObjectId("6a5b1476238d3b4dd5000002"),
        name: "Garden & Outdoor",
        slug: "outdoors",
        description: "Everything for your garden and outdoor activities"
    },
    {
        _id: ObjectId("6a5b1476238d3b4dd5000003"),
        name: "Tools & Hardware",
        slug: "tools",
        description: "Tools and hardware for all your projects"
    },
    {
        _id: ObjectId("6a5b1476238d3b4dd5000004"),
        name: "Home & Kitchen",
        slug: "home",
        description: "Home and kitchen essentials"
    },
    {
        _id: ObjectId("6a5b1476238d3b4dd5000005"),
        name: "Sports & Fitness",
        slug: "sports",
        description: "Sports equipment and fitness gear"
    }
]

db.categories.insertMany(categories)
console.log(`=== ì¹´í…Œê³ ë¦¬ ${categories.length}ê°œ ìƒì„± ì™„ë£Œ ===`)

// === 3. ì‚¬ìš©ì ë°ì´í„° (100ëª…) ===
const users = []
const firstNames = ["John", "Jane", "Mike", "Sarah", "David", "Lisa", "Tom", "Emma", "Chris", "Anna",
    "Mark", "Kelly", "Steve", "Amy", "Brian", "Jessica", "Ryan", "Michelle", "Kevin", "Laura"]
const lastNames = ["Smith", "Johnson", "Brown", "Davis", "Wilson", "Garcia", "Miller", "Taylor", "Anderson", "Jackson",
    "White", "Harris", "Martin", "Thompson", "Martinez", "Robinson", "Clark", "Rodriguez", "Lewis", "Lee"]
const states = ["NY", "CA", "TX", "FL", "IL", "PA", "OH", "GA", "NC", "MI"]
const cities = ["New York", "Los Angeles", "Chicago", "Houston", "Phoenix", "Philadelphia", "San Antonio", "San Diego", "Dallas", "San Jose"]

for(let i = 1; i <= 100; i++) {
    const firstName = firstNames[Math.floor(Math.random() * firstNames.length)]
    const lastName = lastNames[Math.floor(Math.random() * lastNames.length)]

    users.push({
        _id: ObjectId(),
        username: `user${i}`,
        first_name: firstName,
        last_name: lastName,
        birth_year: 1970 + Math.floor(Math.random() * 35), // 1970-2004
        email: `${firstName.toLowerCase()}.${lastName.toLowerCase()}${i}@example.com`,
        addresses: [
            {
                name: "home",
                street: `${100 + Math.floor(Math.random() * 900)} Main Street`,
                city: cities[Math.floor(Math.random() * cities.length)],
                state: states[Math.floor(Math.random() * states.length)],
                zip: 10000 + Math.floor(Math.random() * 80000)
            }
        ]
    })
}

db.users.insertMany(users)
console.log(`=== ì‚¬ìš©ì ${users.length}ëª… ìƒì„± ì™„ë£Œ ===`)

// === 4. ìƒí’ˆ ë°ì´í„° (ì¹´í…Œê³ ë¦¬ë³„ 10ê°œì”© = ì´ 50ê°œ) ===
const products = []
const colors = ["red", "blue", "green", "black", "white", "gray", "yellow", "orange", "purple", "brown"]
const manufacturers = ["ACME", "ProTools", "GardenMax", "TechCorp", "HomeStyle", "SportsPro", "QualityBrand", "SuperMax"]
const baseTags = ["popular", "sale", "new", "premium", "basic", "professional", "portable", "durable"]

// ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ í…œí”Œë¦¿ (10ê°œì”©)
const productTemplates = {
    "Electronics": [
        "Laptop", "Smartphone", "Tablet", "Smart Watch", "Wireless Headphones",
        "Gaming Console", "Digital Camera", "Bluetooth Speaker", "Smart TV", "Drone"
    ],
    "Garden & Outdoor": [
        "Wheel Barrow", "Garden Hose", "Pruning Shears", "Lawn Mower", "Fertilizer Spreader",
        "Garden Rake", "Watering Can", "Plant Pots", "Garden Gloves", "Outdoor Umbrella"
    ],
    "Tools & Hardware": [
        "Power Drill", "Hammer Set", "Screwdriver Kit", "Circular Saw", "Tool Box",
        "Measuring Tape", "Level Tool", "Wrench Set", "Pliers Set", "Safety Goggles"
    ],
    "Home & Kitchen": [
        "Blender", "Coffee Maker", "Non-stick Pan", "Rice Cooker", "Air Fryer",
        "Kitchen Scale", "Cutting Board", "Knife Set", "Mixing Bowls", "Food Processor"
    ],
    "Sports & Fitness": [
        "Yoga Mat", "Dumbbell Set", "Running Shoes", "Treadmill", "Exercise Bike",
        "Resistance Bands", "Medicine Ball", "Jump Rope", "Foam Roller", "Gym Bag"
    ]
}

let productCounter = 1

categories.forEach(category => {
    const categoryProducts = productTemplates[category.name]

    console.log(`=== ${category.name} ì¹´í…Œê³ ë¦¬ì— ìƒí’ˆ 10ê°œ ìƒì„± ì¤‘... ===`)

    categoryProducts.forEach((productName, index) => {
        // ì¼ë¶€ ìƒí’ˆì€ color í•„ë“œ ì—†ìŒ ($exists í…ŒìŠ¤íŠ¸ìš©)
        const details = {
            manufacturer: manufacturers[Math.floor(Math.random() * manufacturers.length)],
            weight: `${1 + Math.floor(Math.random() * 20)} lbs`,
            material: ["steel", "plastic", "aluminum", "wood", "rubber"][Math.floor(Math.random() * 5)]
        }

        // 80% í™•ë¥ ë¡œ color í•„ë“œ ì¶”ê°€
        if(Math.random() > 0.2) {
            details.color = colors[Math.floor(Math.random() * colors.length)]
        }

        // ì¹´í…Œê³ ë¦¬ë³„ íŠ¹ë³„ íƒœê·¸ ì¶”ê°€
        const categoryTags = {
            "Electronics": ["tech", "digital", "smart"],
            "Garden & Outdoor": ["gardening", "outdoor", "soil"],
            "Tools & Hardware": ["tools", "construction", "DIY"],
            "Home & Kitchen": ["kitchen", "cooking", "home"],
            "Sports & Fitness": ["fitness", "exercise", "sport"]
        }

        const tags = [
            baseTags[Math.floor(Math.random() * baseTags.length)], // ëœë¤ ê¸°ë³¸ íƒœê·¸ 1ê°œ
            baseTags[Math.floor(Math.random() * baseTags.length)], // ëœë¤ ê¸°ë³¸ íƒœê·¸ 1ê°œ (ì¤‘ë³µ ê°€ëŠ¥)
            ...categoryTags[category.name] // ì¹´í…Œê³ ë¦¬ë³„ íƒœê·¸ 3ê°œ
        ]

        products.push({
            _id: ObjectId(),
            name: `${productName} Pro ${productCounter}`,
            slug: `${productName.toLowerCase().replace(/\s+/g, '-')}-${productCounter}`,
            sku: `SKU${productCounter.toString().padStart(4, '0')}`,
            main_cat_id: category._id,
            category_id: category._id,
            price: Math.round((20 + Math.random() * 480) * 100) / 100, // $20-$500
            description: `Professional grade ${productName.toLowerCase()} with premium features and reliable performance. Perfect for both beginners and professionals.`,
            tags: [...new Set(tags)], // ì¤‘ë³µ ì œê±°
            details: details,
            helpful_votes: Math.floor(Math.random() * 300),
            total_reviews: 0, // ë‚˜ì¤‘ì— ì‹¤ì œ ë¦¬ë·° ê°œìˆ˜ë¡œ ì—…ë°ì´íŠ¸
            average_rating: 0, // ë‚˜ì¤‘ì— ì‹¤ì œ í‰ê· ìœ¼ë¡œ ê³„ì‚°
            in_stock: Math.random() > 0.1, // 90% ì¬ê³  ìˆìŒ
            inventory_count: Math.floor(Math.random() * 100) + 10,
            created_at: new Date(2024, Math.floor(Math.random() * 4), Math.floor(Math.random() * 28) + 1) // 2024ë…„ 1-4ì›”
        })

        productCounter++
    })
})

db.products.insertMany(products)
console.log(`=== ìƒí’ˆ ${products.length}ê°œ ìƒì„± ì™„ë£Œ (ì¹´í…Œê³ ë¦¬ë³„ 10ê°œì”©) ===`)

// === 5. ë¦¬ë·° ë°ì´í„° (ìƒí’ˆë³„ 20-50ê°œ) ===
const reviews = []
const reviewTitles = [
    // ê¸ì •ì  ë¦¬ë·° (5ì )
    "Amazing product!", "Love it!", "Excellent quality", "Great value for money", "Highly recommend",
    "Perfect for my needs", "Outstanding performance", "Very satisfied", "Fantastic buy", "Exceeded expectations",
    "Top quality", "Works perfectly", "Great design", "Super fast delivery", "Professional grade",

    // ì¢‹ì€ ë¦¬ë·° (4ì )
    "Good product", "Pretty good", "Nice quality", "Satisfied with purchase", "Works well",
    "Good value", "Solid product", "Does what it should", "Happy with it", "Reliable",

    // ë³´í†µ ë¦¬ë·° (3ì )
    "Average quality", "Decent for the price", "Not bad", "Acceptable quality", "Fair product",
    "Standard features", "Basic but functional", "Okay purchase", "Middle of the road", "Adequate",

    // ë‚˜ìœ ë¦¬ë·° (2ì )
    "Could be better", "Disappointing", "Not great", "Had some issues", "Below expectations",
    "Mediocre quality", "Some problems", "Not impressed", "Needs improvement", "Questionable quality",

    // ë§¤ìš° ë‚˜ìœ ë¦¬ë·° (1ì )
    "Poor quality", "Not worth it", "Broke quickly", "Not as described", "Waste of money",
    "Cheap materials", "Terrible experience", "Complete failure", "Awful product", "Total disappointment"
]

const reviewComments = [
    // 5ì  ëŒ“ê¸€
    "This product exceeded my expectations in every way. The build quality is superb and it performs exactly as advertised. Definitely worth every penny!",
    "Excellent value for the money. Fast shipping and great customer service. Would definitely buy again and recommend to friends.",
    "Perfect size and fits exactly what I needed. The design is sleek and modern. Installation was a breeze. Highly recommend to others!",

    // 4ì  ëŒ“ê¸€
    "Good quality product that does what it's supposed to do. Installation was straightforward and hassle-free. Minor issues but overall satisfied.",
    "Works well for my needs. The price point is reasonable for what you get. Good customer service when I had questions.",
    "Solid build quality and performs as expected. A few minor flaws but nothing major. Would consider buying again.",

    // 3ì  ëŒ“ê¸€
    "Average product with standard features. Nothing special but gets the job done adequately. Price is fair for what you receive.",
    "Decent product for the price range. Has some limitations but works for basic needs. Customer service was helpful when contacted.",
    "Not bad but not great either. Does what it's supposed to do but lacks some features I was hoping for. Acceptable overall.",

    // 2ì  ëŒ“ê¸€
    "Quality could be better for this price range. Had some minor issues that were annoying. Customer service tried to help but problems persist.",
    "Not quite what I expected from the description. The materials feel cheaper than advertised. Works but not impressive.",
    "Had several issues right out of the box. Some features don't work as described. Considering returning it.",

    // 1ì  ëŒ“ê¸€
    "Disappointed with the build quality. Broke after just a few uses despite careful handling. Would not recommend to others at all.",
    "Complete waste of money. Poor construction and terrible performance. Multiple defects noticed immediately. Returned for refund.",
    "Terrible experience from start to finish. Product arrived damaged and replacement had same issues. Save your money and buy elsewhere."
]

let totalReviews = 0

products.forEach((product, productIndex) => {
    const reviewCount = 20 + Math.floor(Math.random() * 31) // 20-50ê°œ
    const productReviews = []

    console.log(`ğŸ“ ${product.name}ì— ë¦¬ë·° ${reviewCount}ê°œ ìƒì„± ì¤‘... (${productIndex + 1}/${products.length})`)

    for(let i = 0; i < reviewCount; i++) {
        const user = users[Math.floor(Math.random() * users.length)]

        // ë” í˜„ì‹¤ì ì¸ í‰ì  ë¶„í¬ (ë†’ì€ í‰ì ì— ê°€ì¤‘ì¹˜)
        const randomValue = Math.random()
        let rating
        if(randomValue < 0.4) rating = 5      // 40% - 5ì 
        else if(randomValue < 0.7) rating = 4 // 30% - 4ì 
        else if(randomValue < 0.85) rating = 3 // 15% - 3ì 
        else if(randomValue < 0.95) rating = 2 // 10% - 2ì 
        else rating = 1                       // 5% - 1ì 

        // í‰ì ì— ë”°ë¥¸ ì œëª©ê³¼ ëŒ“ê¸€ ì„ íƒ
        const titleStartIndex = (rating - 1) * 10
        const commentIndex = (rating - 1) * 3 + Math.floor(Math.random() * 3)

        const review = {
            _id: ObjectId(),
            product_id: product._id,
            user_id: user._id,
            rating: rating,
            title: reviewTitles[titleStartIndex + Math.floor(Math.random() * 10)],
            comment: reviewComments[commentIndex],
            helpful_votes: Math.floor(Math.random() * 50),
            verified_purchase: Math.random() > 0.25, // 75% ì¸ì¦ëœ êµ¬ë§¤
            created_at: new Date(2024, Math.floor(Math.random() * 5), Math.floor(Math.random() * 28) + 1) // 2024ë…„ 1-5ì›”
        }

        productReviews.push(review)
        reviews.push(review)
    }

    // ìƒí’ˆì˜ ì´ ë¦¬ë·° ìˆ˜ì™€ í‰ê·  í‰ì  ê³„ì‚°
    const avgRating = productReviews.reduce((sum, r) => sum + r.rating, 0) / productReviews.length

    // ìƒí’ˆ ì •ë³´ ì—…ë°ì´íŠ¸
    db.products.updateOne(
        {_id: product._id},
        {
            $set: {
                total_reviews: reviewCount,
                average_rating: Math.round(avgRating * 10) / 10
            }
        }
    )

    totalReviews += reviewCount
})

// ë°°ì¹˜ë¡œ ë¦¬ë·° ì‚½ì… (ì„±ëŠ¥ ìµœì í™”)
const batchSize = 500
for(let i = 0; i < reviews.length; i += batchSize) {
    const batch = reviews.slice(i, i + batchSize)
    db.reviews.insertMany(batch)
    console.log(`=== ë¦¬ë·° ë°°ì¹˜ ${Math.floor(i/batchSize) + 1} ì‚½ì… ì™„ë£Œ (${batch.length}ê°œ) ===`)
}

console.log(`=== ë¦¬ë·° ${reviews.length}ê°œ ìƒì„± ì™„ë£Œ (ìƒí’ˆë³„ 20-50ê°œ) ===`)

// === 6. ì„±ëŠ¥ ìµœì í™” ì¸ë±ìŠ¤ ìƒì„± ===
// Products ì¸ë±ìŠ¤
db.products.createIndex({main_cat_id: 1})
db.products.createIndex({category_id: 1})
db.products.createIndex({slug: 1}, {unique: true})
db.products.createIndex({tags: 1})
db.products.createIndex({helpful_votes: -1})
db.products.createIndex({"details.color": 1})
db.products.createIndex({"details.manufacturer": 1})
db.products.createIndex({price: 1})
db.products.createIndex({average_rating: -1})

// Reviews ì¸ë±ìŠ¤
db.reviews.createIndex({product_id: 1})
db.reviews.createIndex({product_id: 1, helpful_votes: -1})
db.reviews.createIndex({user_id: 1})
db.reviews.createIndex({rating: 1})
db.reviews.createIndex({created_at: -1})

// Categories ì¸ë±ìŠ¤
db.categories.createIndex({slug: 1}, {unique: true})

// Users ì¸ë±ìŠ¤
db.users.createIndex({username: 1}, {unique: true})
db.users.createIndex({birth_year: 1})
db.users.createIndex({"addresses.state": 1})

console.log("=== ì¸ë±ìŠ¤ ìƒì„± ì™„ë£Œ ===")



// === ìƒí’ˆ ì •ë³´ ì¡°íšŒ ===
db.products.find()
product = db.products.findOne({'slug': 'laptop-1'})
console.log(product)

// === ì—°ê´€ ë°ì´í„° ì¡°íšŒ ===
// í•´ë‹¹ ìƒí’ˆì˜ ì¹´í…Œê³ ë¦¬ ì •ë³´
db.categories.findOne({'_id': product['main_cat_id']})


// í•´ë‹¹ ìƒí’ˆì˜ ë¦¬ë·° ëª©ë¡
db.reviews.find({'product_id': product['_id']})






// === ê¸°ë³¸ í˜ì´ì§€ë„¤ì´ì…˜ ===
product = db.products.findOne({'slug': 'laptop-1'})
console.log(product)


// ì²« ë²ˆì§¸ í˜ì´ì§€ (0-11ë²ˆì§¸ ë¦¬ë·°)
db.reviews.find({'product_id': product['_id']})
db.reviews.countDocuments({'product_id': product['_id']})


db.reviews.find({'product_id': product['_id']})
    .skip(0)
    .limit(12)
    .sort({'helpful_votes': -1})


// === ì™„ì „í•œ í˜ì´ì§€ë„¤ì´ì…˜ ì‹œìŠ¤í…œ ===
page_number = 1  // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
page_size = 12   // í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜

product = db.products.findOne({'slug': 'laptop-1'})

// ì „ì²´ ë¦¬ë·° ê°œìˆ˜ (ì‹  ë²„ì „ - MongoDB 4.0+)
reviews_count = db.reviews.countDocuments({'product_id': product['_id']})


// í˜ì´ì§€ë„¤ì´ì…˜ëœ ë¦¬ë·° ì¡°íšŒ
reviews = db.reviews.find({'product_id': product['_id']})
    .skip((page_number - 1) * page_size)
    .limit(page_size)
    .sort({'helpful_votes': -1})



// === ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ===

db.categories.find()

category = db.categories.findOne({'slug': 'electronics'})

console.log(category)

// í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ìƒí’ˆ ëª©ë¡ + í˜ì´ì§€ë„¤ì´ì…˜(5ê°œë‹¹ 1í˜ì´ì§€)
db.products.find({'category_id': category['_id']})
page_number = 1
page_size = 5
products = db.products.find({'category_id': category['_id']})
    .skip((page_number - 1) * page_size)
    .limit(page_size)
    .sort({'helpful_votes': -1})


// ë°ì´í„° íƒ€ì…ë³„ ì¿¼ë¦¬
db.items.insertMany([
    { "_id" : ObjectId("4caf82011b0978483ea29ada"), "value" : 97 },
    { "_id" : ObjectId("4caf82031b0978483ea29adb"), "value" : 98 },
    { "_id" : ObjectId("4caf82051b0978483ea29adc"), "value" : 99 },
    { "_id" : ObjectId("4caf820d1b0978483ea29ade"), "value" : "a" },
    { "_id" : ObjectId("4caf820f1b0978483ea29adf"), "value" : "b" },
    { "_id" : ObjectId("4caf82101b0978483ea29ae0"), "value" : "c" }
])

// === íƒ€ì…ë³„ ë²”ìœ„ ê²€ìƒ‰ ===
// ì •ìˆ˜ ë²”ìœ„ ê²€ìƒ‰ (ìˆ«ì ë°ì´í„°ë§Œ ë°˜í™˜)
db.items.find({'value': {'$gte': 97}})

// ë¬¸ìì—´ ë²”ìœ„ ê²€ìƒ‰ (ë¬¸ìì—´ ë°ì´í„°ë§Œ ë°˜í™˜)
db.items.find({'value': {'$gte': "a"}})


// === ë‹¤ì¤‘ ìƒí’ˆ ê²€ìƒ‰ ===
db.products.find()
db.products.find({
    'slug': {
        '$in': [
            'laptop-1',
            'smartphone-2',
            'tablet-3'
        ]
    }
})


// === OR ì¡°ê±´ (ìƒ‰ìƒ ë˜ëŠ” ì œì¡°ì‚¬ë¡œ ê²€ìƒ‰) ===
db.products.find({
    '$or': [
        {'details.color': 'blue'},
        {'details.manufacturer': 'ACME'}
    ]
})

// === ë³µí•© íƒœê·¸ ê²€ìƒ‰ (ë‘ íƒœê·¸ ê·¸ë£¹ ëª¨ë‘ í¬í•¨) ===
db.products.find({
    $and: [
        {tags: {$in: ['new', 'basic']}},
        {tags: {$in: ['tech', 'digital']}}
    ]
})

// === í•„ë“œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ===
// ìƒ‰ìƒ ì •ë³´ê°€ ì—†ëŠ” ìƒí’ˆ
db.products.find({'details.color': {$exists: false}})
db.products.countDocuments({'details.color': {$exists: false}})

// ìƒ‰ìƒ ì •ë³´ê°€ ìˆëŠ” ìƒí’ˆ
db.products.find({'details.color': {$exists: true}})
db.products.countDocuments({'details.color': {$exists: true}})





// === ë°°ì—´ ìš”ì†Œ ê²€ìƒ‰ ===
// ë°°ì—´ì— "premium" í¬í•¨ëœ ëª¨ë“  ë¬¸ì„œ
db.products.find({tags: "premium"})

// ì²« ë²ˆì§¸ íƒœê·¸ê°€ "soil"ì¸ ë¬¸ì„œë§Œ
db.products.find({'tags.0': "premium"})



// === ì¸ë±ìŠ¤ ê¸°ë°˜ ê²€ìƒ‰ ===
// ì²« ë²ˆì§¸ ì£¼ì†Œì˜ ì£¼(state) ê²€ìƒ‰
db.users.find({'addresses.0.state': "NY"})

// === ì „ì²´ ë°°ì—´ ê²€ìƒ‰ ===
// ëª¨ë“  ì£¼ì†Œ ì¤‘ NYê°€ ìˆëŠ” ì‚¬ìš©ì
db.users.find({'addresses.state': "NY"})

// === ë‹¤ì¤‘ ì¡°ê±´ ê²€ìƒ‰ ($elemMatch ì‚¬ìš©) ===
// ê°™ì€ ë°°ì—´ ìš”ì†Œ ë‚´ì—ì„œ ëª¨ë“  ì¡°ê±´ì´ ë§Œì¡±ë˜ì–´ì•¼ í•¨
db.users.find({
    'addresses': {
        '$elemMatch': {
            'city': 'San Antonio',
            'state': 'NY'
        }
    }
})